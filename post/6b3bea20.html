<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 简单工厂模式 · Lyog's Blogs</title><meta name="description" content="简单工厂模式 - Lyog"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://liuyong.cc/atom.xml" title="Lyog's Blogs"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Lyog's Blogs" type="application/atom+xml">
</head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">Lyog's Blogs</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives/" target="_self" class="li component-nav-item"><p>归档</p></a></ul></nav><!--        ul.shortcut-icons--><!--            each nav_item in theme.nav_icons--><!--                a(href=nav_item[1] target="_blank")--><!--                    img.icon(src=nav_item[0])--></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">简单工厂模式</h1><div class="post-info">Mar 26, 2018</div><div class="post-content"><p>简单工厂模式又称为静态工厂方法模式，定义一个专门的类来创建其它类的实例，根据传入参数的不同，创建的类的实例不同，但它们都有一个共同的父类。</p>
<p>我们正常使用JDBC如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Connection connection = ...</span><br><span class="line">Statement statement = connection.createStatement();</span><br><span class="line">ResultSet resultSet = statement.executeQuery(<span class="string">"SELECT * FROM MYTABLE"</span>);</span><br><span class="line"><span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">    <span class="comment">//数据处理</span></span><br><span class="line">&#125;</span><br><span class="line">statement.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure>
<a id="more"></a> 

<p>如果使用简单工厂模式进行连接不同的数据库，就是如下形式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">create</span><span class="params">(String type, Properties info)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"mysql"</span>.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> MySqlConnection(info);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"oracle"</span>.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> OracleConnection(info);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"db2"</span>.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> DB2Connection(info);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeErrorException(<span class="keyword">null</span>, <span class="string">"unsupported db type ="</span> + type);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面写法比较笨重，打成jar包后无法修改，不符合开闭原则，可以通过反射和配置文件增加灵活性。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionFactory2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">create</span><span class="params">(String type, Properties info)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; clz = getConnectionClass(type);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Constructor&lt;?&gt; constructor = clz.getConstructor(Properties<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            <span class="keyword">return</span> (Connection) constructor.newInstance(info);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"unsupported db type ="</span> + type);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Class <span class="title">getConnectionClass</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实现略</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面来总结一下简单工厂模式的特点。<br><strong>结构：</strong><br><img src="https://ws1.sinaimg.cn/large/80854ce7ly1fpqiqdxt9ij20rn09t0st.jpg" alt="简单工厂模式UML图"><br><strong>优点：</strong></p>
<ol>
<li>通过工厂，客户端免于创建对象的责任，只需要负责消费对象即可。</li>
<li>利用对象多态性和里氏代换原则，在运行时子类覆盖父类对象，易于扩展。</li>
</ol>
<p><strong>缺点：</strong></p>
<ol>
<li>对扩展开放，对修改也开放，不符合开闭原则（通过反射可消除此问题）。</li>
<li>当产品种类庞大之后，难以进行维护。</li>
</ol>
<p><strong>在JDK中的应用：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DateFormat中的应用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DateFormat</span> <span class="keyword">extends</span> <span class="title">Format</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//其它省略</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> DateFormat <span class="title">get</span><span class="params">(LocaleProviderAdapter adapter, <span class="keyword">int</span> timeStyle, <span class="keyword">int</span> dateStyle, Locale loc)</span> </span>&#123;</span><br><span class="line">        DateFormatProvider provider = adapter.getDateFormatProvider();</span><br><span class="line">        DateFormat dateFormat;</span><br><span class="line">        <span class="keyword">if</span> (timeStyle == -<span class="number">1</span>) &#123;</span><br><span class="line">            dateFormat = provider.getDateInstance(dateStyle, loc);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (dateStyle == -<span class="number">1</span>) &#123;</span><br><span class="line">                dateFormat = provider.getTimeInstance(timeStyle, loc);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dateFormat = provider.getDateTimeInstance(dateStyle, timeStyle, loc);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dateFormat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</div></article></div></div></main><footer class="footer-container"><div class="paginator"><a href="/post/54788f73.html" class="prev">PREV</a><a href="/post/1727f503.html" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2021 <a href="https://liuyong.cc">Lyog</a> , Powered By <a href="https://hexo.io/" target="_blank">Hexo</a>.</p></div></footer></body></html>