---
title: 工厂模式
tags:
  - 设计模式
categories: 设计模式
abbrlink: 54788f73
date: 2018-03-27 00:50:45
---
工厂模式是定义一个创建产品对象的工厂接口，将实际创建工作推迟到子类当中。这样做的好处是核心工厂类不在负责产品的创建，只负责具体工厂子类需要实现的接口。增加新的产品时不会对原有的工厂进行修改。
同简单工厂模式一样，我们用JDBC举例子。
我们正常使用JDBC如下所示：
```java
Connection connection = ...
Statement statement = connection.createStatement();
ResultSet resultSet = statement.executeQuery("SELECT * FROM MYTABLE");
while (resultSet.next()) {
    //数据处理
}
statement.close();
connection.close();
```
<!-- more --> 

我们需要做的是先定义一个核心工厂接口，然后创建几个工厂的子类。

```java
//核心工厂类接口
public interface ConnectionFactory {
    public Connection create(String url,String userName,String password);
}

//工厂子类
public class MySqlConnectionFactory implements ConnectionFactory{
    static {
        ConnectionFactoryManager.register(new MySqlConnectionFactory());
    }
    @Override
    public Connection create(String url,String userName,String password) {
        if (acceptURL(url)) {
            //创建并返回Connection
        }
        return null;
    }
    public boolean acceptURL(String url) {
        return url.startsWith("jdbc:mysql");
    }
}

public class DB2ConnectionFactory implements ConnectionFactory{
    //省略
}

public class OracleConnectionFactory implements ConnectionFactory{
    //省略
}
```
然后创建一个类去管理工厂：
```java
public class ConnectionFactoryManager {
    
    private static List<ConnectionFactory> factories = new ArrayList<>();
    public static Connection getConnection(String url,String userName,String password) {
        for (ConnectionFactory connectionFactory : factories) {
            Connection connection = connectionFactory.create(url, userName,password);
            if (connection != null) {
                return connection;
            }
        }
        throw new RuntimeException("can't create connection!");
    }
    public static void register(ConnectionFactory factory) {
        factories.add(factory);
    }
}
```
在客户端直接通过ConnectionFactoryManager就可以生成Connection：
```java
Class.forName("cc.liuyong.mysql.MysqlConnectionFactory");
Connection connection = ConnectionFactoryManager.getConnection("jdbc:mysql://127.0.0.1:3306/mydatabase", "root", "123456");
```
下面总结一下工厂模式的特点。
**UML图：**
![工厂模式UML类图][1]
**优点：**
1. 客户端不需要依赖具体工厂和具体产品编程，只需要依赖于抽象工厂和抽象产品完成工作。（符合依赖倒置原则）
2. 新增一种产品时，只需要增加相应的具体产品类和相应的工厂子类即可。（符合开闭原则）

**缺点：**
1. 添加新产品时，还需要添加对应的工厂类，增加了系统复杂性。
2. 一个工厂只能创建一种产品。


[1]: https://ws1.sinaimg.cn/large/80854ce7ly1fpqoyo90myj20vj09rq30.jpg